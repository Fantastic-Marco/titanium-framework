plugins {
    id 'java'
}

group = 'com.titanium'
version = '0.0.1-SNAPSHOT'

repositories {
    mavenCentral()
}

ext {
    configuration = [
            javaVersion = JavaVersion.VERSION_17
    ]

    libraries = [
            mybatisVersion = '3.5.9',
            mybatisSpringVersion = '2.0.6',
            mybatisSpringBootStarterVersion = '2.2.1',
            springVersion = '5.3.9',
            springBootVersion = '3.2.5',
            jsqlparserVersion = '4.3',
            junitVersion = '5.7.2',
    ]

    lib = [
            "mybatis"                    : "org.mybatis:mybatis:${mybatisVersion}",
            "mybatis-spring"             : "org.mybatis:mybatis-spring:${mybatisSpringVersion}",
            "mybatis-thymeleaf"          : "org.mybatis.scripting:mybatis-thymeleaf:1.0.3",
            "mybatis-freemarker"         : "org.mybatis.scripting:mybatis-freemarker:1.2.3",
            "mybatis-velocity"           : "org.mybatis.scripting:mybatis-velocity:2.1.1",
            "spring-context-support"     : "org.springframework:spring-context-support:${springVersion}",
            "spring-jdbc"                : "org.springframework:spring-jdbc:${springVersion}",
            "spring-tx"                  : "org.springframework:spring-tx:${springVersion}",
            "spring-web"                 : "org.springframework:spring-web:${springVersion}",
            "spring-aop"                 : "org.springframework:spring-aop:${springVersion}",
            "aspectjrt"                  : "org.aspectj:aspectjrt:1.9.6",
            "cglib"                      : "cglib:cglib:3.3.0",
            "imadcn"                     : "com.imadcn.framework:idworker:1.5.0",
            "spring-cloud-commons"       : "org.springframework.cloud:spring-cloud-commons:3.0.3",

            "javax.servlet-api"          : "javax.servlet:javax.servlet-api:4.0.1",
            "aspectjweaver"              : "org.aspectj:aspectjweaver:1.9.7",
            "slf4j-api"                  : "org.slf4j:slf4j-api:1.7.32",
            "logback-classic"            : "ch.qos.logback:logback-classic:1.2.5",
            //copy
            "mybatis-spring-boot-starter": "org.mybatis.spring.boot:mybatis-spring-boot-starter:${mybatisSpringBootStarterVersion}",
            //test
            "spring-test"                : "org.springframework:spring-test:${springVersion}",
            "assertj-core"               : "org.assertj:assertj-core:3.22.0",
            "junit-jupiter"              : "org.junit.jupiter:junit-jupiter:${junitVersion}",
            "fastjson"                   : "com.alibaba:fastjson:1.2.76",
            "jackson"                    : "com.fasterxml.jackson.core:jackson-databind:2.12.5",
            "gson"                       : "com.google.code.gson:gson:2.8.8",
            "lagarto"                    : "org.jodd:jodd-lagarto:6.0.5",
            //datasource
            "p6spy"                      : "p6spy:p6spy:3.9.1",
            "sqlserver"                  : "com.microsoft.sqlserver:sqljdbc4:4.0",
            "postgresql"                 : "org.postgresql:postgresql:42.2.20",
            "oracle"                     : fileTree(dir: 'libs', includes: ['ojdbc-11.2.0.3-jdk16.jar']),
            "dm"                         : fileTree(dir: 'libs', includes: ["jdbcDriver-18.jar"]),
            "kingbase"                   : fileTree(dir: 'libs', includes: ["kingbase8-8.2.0.jar"]),
            "h2"                         : "com.h2database:h2:2.0.206",
            "mysql"                      : "mysql:mysql-connector-java:8.0.26",
            "sqlite"                     : "org.xerial:sqlite-jdbc:3.36.0.3",
            "firebird"                   : "org.firebirdsql.jdbc:jaybird:4.0.5.java8",
            //cache
            "mybatis-ehcache"            : "org.mybatis.caches:mybatis-ehcache:1.2.1",
            "mybatis-redis"              : "org.mybatis.caches:mybatis-redis:1.0.0-beta2",
            "mybatis-caffeine"           : "org.mybatis.caches:mybatis-caffeine:1.0.0"
    ]
}

allprojects {
    repositories {
        mavenCentral()
    }
}

subprojects {
// 设置最低支持的 JDK 版本
    java.sourceCompatibility = JavaVersion.VERSION_17
    java.targetCompatibility = JavaVersion.VERSION_17

// 应用共享插件
    apply plugin: 'java'
    apply plugin: 'maven-publish'

    repositories {
        maven { url 'https://maven.aliyun.com/repository/google' }
        maven { url 'https://maven.aliyun.com/repository/public/' }
    }

    publishing {
        publications {
            maven(MavenPublication) {
                from components.java
            }
        }

        repositories {
            maven {
                url 'file://' + System.getProperty('user.home') + '/.m2/repository'
            }
        }
    }

    task publishToLocal {
        group = 'build'
        dependsOn tasks.clean
        dependsOn tasks.build
        dependsOn tasks.publish
        dependsOn tasks.publishMavenPublicationToMavenLocal
    }

    publishToLocal.description = 'Publish to local maven repository'
}
